
<!DOCTYPE html>
<html>
<head><meta charset="utf-8"><title>Debug Dashboard</title></head>
<body>
  <h2>🎯 Debug Upload</h2>
  <input type="file" id="upload" accept="audio/*,video/*"><br><br>
  <button id="uploadBtn">Hochladen</button>
  <pre id="status" style="white-space: pre-wrap; font-family: monospace; background: #eee; padding: 1em;"></pre>

  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2"
    const supabase = createClient(
      "https://ejgjwijbbanpxylbrumr.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVqZ2p3aWpiYmFucHh5bGJydW1yIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg0NDkwOTksImV4cCI6MjA2NDAyNTA5OX0.K3SuYyTYHO-5_QBZ0pMGTMgcpI0wdGTM5Zo65_shww0"
    );

    const log = (msg) => {
      const s = document.getElementById("status");
      s.innerText += "\n" + msg;
    }

    async function uploadFile() {
      log("📦 Upload gestartet");
      const fileInput = document.getElementById("upload");
      if (!fileInput) return log("❌ Kein file input gefunden!");

      const file = fileInput.files[0];
      if (!file) return log("⚠️ Bitte zuerst eine Datei auswählen.");

      log("📁 Datei: " + file.name);

      try {
        const userResp = await supabase.auth.getUser();
        log("🔑 getUser() aufgerufen");
        const user = userResp.data?.user;
        if (!user) return log("❌ Kein Benutzer angemeldet oder Token ungültig");

        log("👤 User ID: " + user.id);

        const filePath = user.id + "/" + file.name;
        log("📤 Datei wird hochgeladen an: " + filePath);

        const result = await supabase.storage.from("media").upload(filePath, file, { upsert: true });

        if (result.error) {
          log("❌ Fehler beim Upload: " + result.error.message);
        } else {
          const mediaUrl = "https://ejgjwijbbanpxylbrumr.supabase.co/storage/v1/object/public/media/" + filePath;
          const playbackUrl = "play.html?u=" + user.id;
          log("✅ Upload erfolgreich!");
          log("🌐 Medien-URL: " + mediaUrl);
          log("▶️ Wiedergabe-Link: " + playbackUrl);
        }
      } catch (err) {
        log("🚨 JavaScript Fehler: " + err.message);
      }
    }

    document.getElementById("uploadBtn").addEventListener("click", uploadFile);
  </script>
</body>
</html>
